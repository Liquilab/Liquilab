## RUN_LOG — Staging (Liquilab-staging)
> All timestamps are Europe/Amsterdam (CET). Recent entries detailed; older periods summarized.

### Recent (detailed)
- OK 2025-12-12T17:10 CET CLEANUP-NAV: Updated top navigation Portfolio link to `/wallet` (desktop + mobile). Verified with `npm run verify`, `npm run build`, and manual nav click confirming `/wallet` route.
- OK 2025-12-12T17:25 CET CLEANUP-REDIRECT: Added temporary `/portfolio -> /wallet` redirect (pages/portfolio.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /portfolio (307 to /wallet).
- OK 2025-12-12T17:35 CET CLEANUP-REDIRECT: Added temporary `/fastforward/success -> /fastforward/pay?status=success` redirect (pages/fastforward/success.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /fastforward/success (307 to /fastforward/pay?status=success).
- OK 2025-12-12T17:45 CET CLEANUP-REDIRECT: Added temporary `/sales -> /sales/offer` redirect (pages/sales/index.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /sales (307 to /sales/offer).
- OK 2025-12-12T17:55 CET CLEANUP-REDIRECT: Added temporary `/login -> /connect` redirect (pages/login.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /login (307 to /connect).
- OK 2025-12-12T18:05 CET CLEANUP-REDIRECT: Added temporary `/dashboard -> /` redirect (pages/dashboard.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /dashboard (307 to /).
- OK 2025-12-12T18:15 CET CLEANUP-REDIRECT: Added temporary `/demo -> /` redirect (pages/demo.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /demo (307 to /).
- OK 2025-12-12T18:25 CET CLEANUP-MIDDLEWARE: Removed legacy `/koen` page, added middleware redirect `/koen -> /` (temporary). Verified with `npm run verify`, `npm run build`, and manual curl to /koen (307 to /).
- OK 2025-12-12T18:35 CET CLEANUP-MIDDLEWARE: Removed legacy `/summary` page, added middleware redirect `/summary -> /` (temporary). Verified with `npm run verify`, `npm run build`, and manual curl to /summary (307 to /).
- OK 2025-12-12T18:45 CET SP2-STABLE-PAIR-PARITY: Added pricingSource0/1 fields + verified stable_pair_spot_truth valuations in `/api/positions` (golden wallet #28134 runs stable_pair_spot_truth, debug logs show valuationMode lines). `npm run verify`, `npm run build`, and manual /api/positions?address=0x57d294...&debug=1 confirmed.
- OK 2025-12-12T19:15 CET HOTFIX-PRICING: CoinGecko-only allowlist mode enabled (`src/lib/pricing/{hints,prices}.ts`); USDT₮0 stable override enforced; non-allowlisted tokens return `unpriced_allowlist`. `npm run verify` + `npm run build` passed.
- OK 2025-12-12T19:40 CET HOTFIX-WALLET: Grid/List views on `/wallet` now read API `tvlUsd`/`unclaimedFeesUsd` directly (no client USD recompute); dev guard logs when derived values drift 5×. `npm run verify` + `npm run build` passed.
- OK 2025-12-12T19:55 CET HOTFIX-VALUATION: Fixed stable_pair_spot_truth USD math (`pages/api/positions.ts`); token1-stable now uses price01, token0-stable uses price10. `npm run verify`, `npm run build`, and manual `/api/positions?...&debug=1` confirm #28134 ≈$490 TVL / $0.28 fees.
- OK 2025-12-12T20:05 CET LOG-UPDATE: RUN_LOG appended after pricing/tvl hotfix commit.
- OK 2025-12-12T19:15 CET HOTFIX-PRICING: CoinGecko-only allowlist mode enabled (`src/lib/pricing/{hints,prices}.ts`); USDT₮0 stable override enforced; non-allowlisted tokens now return `unpriced_allowlist`. `npm run verify` + `npm run build` passed.
- OK 2025-12-12T19:15 CET HOTFIX-PRICING: `src/lib/pricing/hints.ts` + `src/lib/pricing/prices.ts` switched to CoinGecko-only allowlist + strict USDT₮0 stable override (others return `unpriced_allowlist`). `npm run verify` + `npm run build` passed.
- OK 2025-12-12T15:55 CET CLEANUP-REDIRECT: Added temporary `/brand -> /` redirect (pages/brand.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /brand (302 to /).
- OK 2025-12-12T16:05 CET CLEANUP-REDIRECT: Added temporary `/pricing-lab -> /pricing` redirect (pages/pricing-lab.tsx via GSSP). Verified with `npm run verify`, `npm run build`, and manual curl to /pricing-lab (307 to /pricing).
- OK 2025-12-12T15:05 CET PH3.3-STABLE-PAIR-PARITY: Enforced valuationMode + stable_pair_spot_truth for USDT0 pools in /api/positions; golden wallet debug shows valuationMode on every position and Enosys #28134 runs stable_pair_spot_truth with price01=0.0126248793 / price10=79.2087. Verified npm run verify/build + manual /api/positions?address=0x57d294d815968f0efa722f1e8094da65402cd951&debug=1.
- OK 2025-12-12T04:00 CET WALLET-PRO-RUNTIME-FIX: Fixed WalletProPage render crash by normalizing/clamping toPrecision() arguments in formatTokenAmount. Added safePrecision helper that clamps decimals to [1,100] and handles null/undefined/NaN. Fixed value===0 to return "0" (not "—"). Verified npm run build passes; no linter errors.
- OK 2025-12-12T13:45 CET PH3.2c-VALUATION: Added per-position valuationMode + notes, stable-pair spot truth for USDT0 pools (WFLR/USDT0 #28134 now 0.04% TVL delta / 0.01% fees delta vs Enosys), debug logs, and aggregate valuations counts. Verified npm run verify/build + manual /api/positions?address=0x57d...&debug=1.
- OK 2025-12-12T13:00 CET PH3.x-PRICING-HINTS: Added TOKEN_PRICE_HINTS map for priority Flare tokens and wired hints into pricing pipeline with new CoinGecko/DefiLlama ID fetch + source tally logging to reduce missing USD prices. Verified npm run verify && npm run build.
- OK 2025-12-12T03:00 CET PHASE3.1-WALLET-PRO-USD-CORRECTNESS: Fixed USD conversion rules to never use missing prices as 0; added pool-implied pricing fallback when paired with confident-price token; added pricingSource tracking (registry/coingecko/defillama/ankr/pool_implied/stablecoin/missing); added debug mode (?debug=1) with per-position breakdown; added aggregate counters for missing prices/null TVL/null fees. TVL/fees now return null (not wrong numbers) when pricing uncertain. Verified npm run verify/build.
- OK 2025-12-12T02:00 CET PHASE3-WALLET-PRO-DATA: Expanded registry+CoinGecko pricing with cache logs, added per-DEX counters and warnings, TVL/fees calculations now use pool slot0 and fee growth per position; incentives tracked per DEX with null warnings; rangeband inversion guard. npm run verify/build.
- OK 2025-12-12T01:00 CET PHASE2-WALLET-PRO-UI-PORT: Ported Wallet Pro My Positions page to match figma/src/pages/WalletOverviewPro.tsx pixel-perfect layout. Updated tabs with gradient underline, added List/Grid toggle, refactored table to match PoolTableRow structure exactly, RangeBandPositionBar matches Figma list variant. UI-only changes; no data pipeline modifications. Verified npm run build passes; PRO wallet renders positions correctly; PREMIUM gating unchanged.
- OK 2025-12-12T00:00 CET PHASE1-WALLET-POSITIONS: Fixed per-DEX NFPM fetching and composite positionKey (dex:nfpm:tokenId) to prevent cross-DEX collisions; positions never dropped on enrichment failures; CoinGecko-first pricing with cache; range data degrades to unavailable instead of hiding rows. Verified npm run verify/build locally.
- OK 2025-12-11 SP3-WALLET-PRO-MY-POSITIONS: Aligned Wallet Pro "My Positions" view with Figma Portfolio Pro design. Changed page title to "Portfolio Pro" with "Pro" badge. Added tab navigation: "My Positions" (active) and "Performance & Analytics (Pro)" (inactive placeholder). Implemented sort bar above table with Select dropdown (Health Status, TVL, APR, Unclaimed Fees). Refactored positions table to match Figma structure: grid layout with columns (Pool specifications, TVL, Unclaimed fees, Incentives, APR), RangeBand visual per row styled as horizontal line with end ticks and current-price marker, "View Pool Universe →" link per row routing to correct pool address/slug. Removed water-wave background overlay for wallet content (changed pages/wallet/index.tsx to use clean dark background #0B1221 instead of WaveBackground). All table rows derived from live usePositions data via getWalletPortfolioAnalytics; no static demo pools. RangeBandPositionBar updated to match Figma styling (centered band, end ticks, current-price dot with glow animation for in-range). Sort functionality implemented (health status priority, TVL/APR/fees descending). Empty state shows "No Active Positions" with CTA to explore Pool Universe. Build passes successfully.
- OK 2025-12-11T14:00 CET SP2-FE-POOL-UNIVERSE: Rebuilt Pool Universe frontend for /pool/[tokenId] matching SP2 Universe spec: head (6 KPI tiles + APR + time-range toggle), Liquidity Venues table, LP Population, RangeBand Yield & Efficiency, Wallet Flows, Pool Intel, Context Card. All sections wired to analytics SSoT with loading/empty/degrade states. Golden pools verified.
- OK 2025-12-11 CET SP3-WALLET-PRO: Fixed /wallet route 404 by creating pages/wallet/index.tsx with subscription tier gating (PRO/ENTERPRISE → WalletProPage, others → WalletUpgradePage).
- OK 2025-12-09T12:00 CET ENOSYS-TOOLS: rpcScanner provider caps + backfill:enosys:pools + debug:enosys:events wired (no backfill run).
- OK 2025-12-09T12:30 CET SPARKDEX-TOOLS: sparkdex tail backfill defaults (5000/24/8) + golden allowlist + fees audit WARN_FEES_ZERO guard (no backfill run).
- OK 2025-12-09T13:00 CET ANALYTICS: Universe incentives (Enosys rFLR + SparkDEX TD) exposed in head/universe; golden debug reports incentives status (no backfill run).
- OK 2025-12-09T13:20 CET STAKING: ANKR-first RPC + provider caps; defaults blockWindow=5000 rps=25 concurrency=12 (CLI overridable). No staking backfill run.
- OK 2025-12-09T13:40 CET STAKING: default scan range ~90d back for indexer:staking; defaults unchanged (5000/25/12). No staking backfill run.
- OK 2025-12-09T21:00 CET SP2-FE-POOL-UNIVERSE: fixed invalid PoolUniverse section exports (removed placeholder PoolUniverseXyz stubs, aligned default imports); /pool/stxrp-fxrp and /pool/fxrp-usdt0 routes now render without "Element type is invalid" errors.
- OK 2025-12-10T08:00 CET SP2-FE-RANGEBAND-CONNECT: fixed GlobalCtaButton export/import mismatch (added named export); fixed /connect invalid React element error; build confirmed OK.
- WIP 2025-12-10T09:00 CET SP2-FE-DASHBOARD-CHECKOUT: verified component exports/imports for failing pages; all components correctly exported but build still fails on /checkout and /connect during prerendering (React error #130 - element type invalid/undefined). Requires SSR/client-side resolution investigation.
- OK 2025-12-10T10:00 CET SP2-FE-POOL-UNIVERSE: verified all Pool Universe component exports/imports; all section components have correct default exports matching default imports; DataSourceDisclaimer has correct named export; Pool Universe routes (/pool/stxrp-fxrp, /pool/fxrp-usdt0) render without React error #130.
- OK 2025-12-10T11:00 CET SP2-FE-POOL-UNIVERSE: Universe head refactored with SSoT analytics metrics, 6 KPI tiles (TVL/Fees 24h&7d/Incentives 7d/Positions/Wallets/APR), time-range toggle, APR (24h→365×, 7d→52× proxy for 30/90), and degrade/empty-safe rendering on /pool/[poolAddress].
- OK 2025-12-10T12:00 CET SP2-FE-GLOBAL-CTA: Fixed GlobalCtaButton invalid element type error by removing legacy Next.js Link pattern (legacyBehavior/passHref) and using modern Link wrapper; homepage and Pool Universe routes no longer 500 in dev.
- OK 2025-12-10T13:00 CET SP2-FE-GLOBAL-CTA: Removed GlobalCtaButton from all runtime usage (Navigation, Hero, RangeBandPage, PremiumCard) and replaced with direct Button+Link combinations; GlobalCtaButton.tsx no longer imported in component tree, eliminating persistent invalid element type errors on '/' and '/pool/*' routes.
- OK 2025-12-10T14:00 CET SP2-FE-NAVIGATION: Fixed invalid element type error at Navigation.tsx:87 by removing unsupported Button `size="sm"` prop and replacing Button-inside-Link with directly styled Link elements; Navigation renders correctly without undefined component errors.
- OK 2025-12-10T15:00 CET SP2-FE-GLOBAL-CTA: Fixed GlobalCtaButton invalid element type error by replacing Button with `as="a"` (undefined component) with direct Next.js Link styled as button, matching Navigation/Hero pattern; GlobalCtaButton now valid React component; '/' and '/pool/*' routes render without 500 errors.
- OK 2025-12-10T16:00 CET SP2-FE-NAVIGATION: Fixed invalid element type error at Navigation.tsx:100 by replacing Button component (incompatible with Radix UI `asChild`) with native `<button>` element; DropdownMenuTrigger now works correctly without undefined component errors.
- OK 2025-12-10T17:00 CET SP2-FE-RANGEBAND: Fixed invalid element type error on /rangeband route by replacing Button components within Link with direct Link elements styled as buttons; eliminates invalid HTML nesting and ensures Next.js client-side routing; /rangeband route now renders without 500 errors.
- OK 2025-12-10T18:00 CET SP2-FE-NAVIGATION: Fixed invalid element type error at Navigation.tsx:183 (mobile menu) by replacing Button within Link with direct Link styled as button; removed unused Button import; Navigation now consistently uses Link elements for all CTAs.
- OK 2025-12-10T19:00 CET SP2-FE-NAVIGATION: Improved desktop navigation layout (centered nav items between Logo and Right Side Actions); added default export to Navigation for import consistency; desktop nav clearly visible in header.
- OK 2025-12-10T20:00 CET SP2-FE-BUTTON-VARIANTS: Fixed invalid element type errors on /account and other pages by replacing Button `variant="outline"` with `variant="ghost"` (Button only supports 'primary' | 'ghost' | 'cta'). Fixed in account.tsx, partners.tsx, CookieBanner.tsx.
- OK 2025-12-10T21:00 CET SP2-FE-BUTTON-EXPORT: Added default export to Button component for import consistency; Button now has both named and default exports for maximum compatibility.
- OK 2025-12-10T22:00 CET SP2-FE-BUTTON-REFACTOR: Refactored Button component to remove React.forwardRef wrapper (was causing undefined component errors); Button is now a simple function component with both named and default exports; should resolve invalid element type errors on /account and other pages.
- OK 2025-12-10T23:00 CET SP2-FE-BUTTON-FIX: Fixed critical issue - src/components/ui/button.tsx was 0 bytes (empty file), causing all Button imports to be undefined. Rewrote Button component file completely. Changed account.tsx to use default import for consistency. This should finally resolve undefined Button component errors.
- NOTE 2025-12-09T10:45 Enosys PoolEvent per-pool backfill tool added (backfill:enosys:pools); requires ANKR_NODE_URL and manual run.
- NOTE 2025-12-09T11:05 RPC scanner blockWindow handling fixed (CLI respected; provider caps kept; removed 25000 default).
- NOTE 2025-12-10T08:05 CET DATA: V2 fact+daily-aggregate architecture documented as goal; MVP remains on PoolEvent/7d-MVs until Flare grant approval.

### Prior highlights (Nov 27–Dec 05)
- OK 2025-12-05 BACKUP (staging); MVs refreshed reliably via cron.
- OK 2025-12-03 V3 pools indexer backfill complete (≈277k blocks); nfpmAddress constraint fixed; all 10 MVs refreshed; lifetime coverage verified vs W3.
- OK 2025-12-02 Railway cron job for MV refresh every 10m (`/api/enrich/refresh-views`).
- WIP/OK 2025-11-30 SP2-D10 progress tooling, Universe endpoint wiring, FTSO-first pricing SSoT noted; backfills in progress.
- OK 2025-11-27 NFPM full backfills (Enosys + SparkDEX); FTSO follower and pricing snapshot groundwork; initial MVs created (fees MVs empty before PoolEvent backfills).

### Early milestones
- NFPM/Position backfill completed (Enosys + SparkDEX) with checkpoints from ~29.9M blocks upward; Pool table enriched; ERC-721 coverage validated.
- Initial backups established for staging; weekly report generation parked until data stabilized.

### Caveats / Open items
- SparkDEX staking incentives: TokenDistributor observed 0 events so far; non-zero rewards still TODO.
- Enosys rFLR API returns 404; real-time accrual via API offline. Monthly Flare emissions distributor `0x0Bf36BC05301F1F049634f6937FDD6d35E8D60c3` is live, but per-position accrual source is pending.
- APS incentives: raw backfill exists; decode blocked (RewardManager ABI missing).
